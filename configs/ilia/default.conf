# =============================================================================
# NGINX-STYLE CONFIGURATION - COMBINED RELATIVE AND FULL PATH TESTING
# =============================================================================
# This configuration combines both relative and full path testing
# Server 1: Relative paths on port 8080
# Server 2: Full paths on port 8081
# =============================================================================

# SERVER 1: RELATIVE PATH CONFIGURATION
server {
	server_name serv_relative
	listen 8080
	host 127.0.0.1
	root /home/ilyam/42/webserver/www
	index index.html
	client_max_body_size 10000

	# REDIRECTION: Test redirection from /old to redirection page
	location /old {
		allow_methods GET
		return /redirect/redirection.html
		index index.html
	}

	# ROOT: Main landing page with file upload/delete links
	location / {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOADS: File upload/download/delete using relative paths (nginx-style)
	location /uploads {
		allow_methods GET DELETE POST
		upload_to uploads
		autoindex on
		index index.html
	}

	# CGI SCRIPTS: Python and JavaScript execution using relative paths
	location /cgi-bin {
		allow_methods GET POST
		cgi_path cgi-bin
		cgi_ext .py .js
		index index.html
	}

	# PYTHON SCRIPTS: Single Python files using relative path
	location .py {
		allow_methods GET POST
		cgi_path .
		cgi_ext .py
		index index.html
	}

	# IMAGES: Directory listing for actual image files
	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOAD PAGE: Static upload form
	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	# DELETE PAGE: Static delete form
	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

# SERVER 2: FULL PATH CONFIGURATION
server {
	server_name serv_full
	listen 8081
	host 127.0.0.1
	root /home/ilyam/42/webserver/www
	index index.html
	client_max_body_size 10000

	# REDIRECTION: Test redirection from /legacy to redirection page
	location /legacy {
		allow_methods GET
		return /redirect/redirection.html
		index index.html
	}

	# ROOT: Main landing page with file upload/delete links
	location / {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOADS: File upload/download/delete using full paths (nginx-style)
	location /uploads {
		allow_methods GET DELETE POST
		upload_to /home/ilyam/42/webserver/www/uploads
		autoindex on
		index index.html
	}

	# CGI SCRIPTS: Python and JavaScript execution using full paths
	location /cgi-bin {
		allow_methods GET POST
		cgi_path /home/ilyam/42/webserver/www/cgi-bin
		cgi_ext .py .js
		index index.html
	}

	# PYTHON SCRIPTS: Single Python files using full path
	location .py {
		allow_methods GET POST
		cgi_path /home/ilyam/42/webserver/www
		cgi_ext .py
		index index.html
	}

	# IMAGES: Directory listing for actual image files
	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOAD PAGE: Static upload form
	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	# DELETE PAGE: Static delete form
	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

# =============================================================================
# TESTING INSTRUCTIONS
# =============================================================================
# Start server: ./webserv configs/ilia/default.conf
# Two servers will run simultaneously:
# - Server 1 (serv_relative) on port 8080 with relative paths
# - Server 2 (serv_full) on port 8081 with full paths
#
# Test both servers with identical requests to compare behavior:
#
# RELATIVE PATH SERVER (port 8080):
# 1. curl http://localhost:8080/                     -> index.html (main page)
# 2. curl http://localhost:8080/old                  -> 302 redirect to /redirect/redirection.html
# 3. curl http://localhost:8080/uploads/              -> directory listing
# 4. curl -X POST http://localhost:8080/uploads/      -> file upload (uses relative upload_to)
# 5. curl -X DELETE http://localhost:8080/uploads/file.txt -> file deletion
# 6. curl http://localhost:8080/cgi-bin/              -> CGI directory listing
# 7. curl http://localhost:8080/cgi-bin/test.py       -> CGI script execution
# 8. curl http://localhost:8080/test.py               -> Python script execution
# 9. curl http://localhost:8080/imgs/                 -> image directory listing
#
# FULL PATH SERVER (port 8081):
# 1. curl http://localhost:8081/                     -> index.html (main page)
# 2. curl http://localhost:8081/legacy                -> 302 redirect to /redirect/redirection.html
# 3. curl http://localhost:8081/uploads/              -> directory listing
# 4. curl -X POST http://localhost:8081/uploads/      -> file upload (uses full upload_to)
# 5. curl -X DELETE http://localhost:8081/uploads/file.txt -> file deletion
# 6. curl http://localhost:8081/cgi-bin/              -> CGI directory listing
# 7. curl http://localhost:8081/cgi-bin/test.py       -> CGI script execution
# 8. curl http://localhost:8081/test.py               -> Python script execution
# 9. curl http://localhost:8081/imgs/                 -> image directory listing
#
# Both servers should produce identical results, demonstrating that your server
# correctly handles both relative and absolute path formats!
# =============================================================================
