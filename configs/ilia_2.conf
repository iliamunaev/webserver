# =============================================================================
# WEBSERVER CONFIGURATION: ilia_2.conf
# =============================================================================
# This configuration demonstrates server-aware routing with 2 isolated servers
# Each server has its own routes and only responds to its configured endpoints
# =============================================================================

# -----------------------------------------------------------------------------
# SERVER 1: Basic Web Server (Port 8080)
# -----------------------------------------------------------------------------
# Features: File serving, upload, delete, admin access
# Root: /home/ilyam/42/webserver/www
# -----------------------------------------------------------------------------
server {
    # Server identification and network configuration
    server_name server_1
    listen 8080
    host 127.0.0.1
    root /home/ilyam/42/webserver/www
    index index.html

    # Root location - serves the main page
    location / {
        allow_methods GET
        index index.html
        autoindex off
    }

    # Upload endpoint - handles file uploads
    location /upload {
        allow_methods GET POST
        index upload.html
        # upload_to /path/to/uploads
    }

    # Delete endpoint - handles file deletion
    location /delete {
        allow_methods GET DELETE
        index delete.html
    }

    # Favicon - serves the site's favicon
    location /favicon.ico {
        allow_methods GET
        index index.html
    }

    # Admin area - restricted access area
    location /admin {
        allow_methods GET
        index index.html
        autoindex off.
    }
}

# -----------------------------------------------------------------------------
# SERVER 2: API & Media Server (Port 8081)
# -----------------------------------------------------------------------------
# Features: API endpoints, image serving, error page access
# Root: /home/ilyam/42/webserver/www
# -----------------------------------------------------------------------------
server {
    # Server identification and network configuration
    server_name server_2
    listen 8081
    host 127.0.0.1
    root /home/ilyam/42/webserver/www
    index index.html

    # Root location - serves the main API page
    location / {
        allow_methods GET
        index index.html
        autoindex off
    }

    # Upload endpoint - shared with server_1 but handled independently
    location /upload {
        allow_methods GET POST
        index upload.html
        # upload_to /path/to/uploads
    }

    # Images directory - serves image files with directory listing
    location /imgs {
        allow_methods GET
        index index.html
        autoindex on
    }

    # Errors directory - serves error pages for debugging
    location /errors {
        allow_methods GET
        index index.html
        autoindex on
    }

    # API endpoint - handles API requests
    location /api {
        allow_methods GET POST
        index index.html
        autoindex off
    }
}

# =============================================================================
# TESTING INSTRUCTIONS & ROUTE ANALYSIS
# =============================================================================
# Start the server: ./webserv configs/ilia_2.conf
#
# ROUTE ANALYSIS:
# Server 1 (port 8080): /, /admin, /delete, /favicon.ico, /upload
# Server 2 (port 8081): /, /api, /errors, /imgs, /upload
# Shared routes: /, /upload (handled independently by each server)
#
# TEST CASES:
#
# Server 1 (port 8080):
# - curl http://localhost:8080/           -> index.html (server_1)
# - curl http://localhost:8080/admin      -> index.html (server_1 only)
# - curl http://localhost:8080/delete     -> delete.html (server_1 only)
# - curl http://localhost:8080/favicon.ico -> index.html (server_1 only)
# - curl http://localhost:8080/upload     -> upload.html (shared route)
#
# Server 2 (port 8081):
# - curl http://localhost:8081/           -> index.html (server_2)
# - curl http://localhost:8081/api        -> index.html (server_2 only)
# - curl http://localhost:8081/imgs       -> directory listing (server_2 only)
# - curl http://localhost:8081/errors     -> error pages (server_2 only)
# - curl http://localhost:8081/upload     -> upload.html (shared, server_2)
#
# CROSS-SERVER ISOLATION TESTS:
# - curl http://localhost:8080/api        -> 404 (route doesn't exist on server_1)
# - curl http://localhost:8081/admin      -> 404 (route doesn't exist on server_2)
#
# This demonstrates perfect server isolation and server-aware routing!
# Each server only responds to its configured routes, proving the implementation works.
# =============================================================================
