# Comprehensive Web Server Configuration for Testing All Handlers and CGI
# Root: /home/ilyam/42/webserver/www
# Features: All HTTP methods, CGI, Upload, Static files, Autoindex, Redirects
# -----------------------------------------------------------------------------
server {
    # Identification and network configuration
    server_name webserv_standart
    listen 8090
    host 127.0.0.1
    root /home/ilyam/42/webserver/www
    index index.html
    client_max_body_size 10

    # Root location - serves the main page with multiple methods
    location / {
        allow_methods GET HEAD POST
        index index.html
        autoindex off
    }

    # Upload page - serves the upload form
    location /upload {
        allow_methods GET HEAD
        index upload.html
    }

    # File upload handler - handles POST requests to /uploads
    location /uploads {
        allow_methods GET HEAD POST DELETE
        upload_to /home/ilyam/42/webserver/www/uploads
        index upload_success.html
    }

    # Delete endpoint - for file deletion
    location /delete {
        allow_methods GET HEAD DELETE
        index delete.html
    }

    # CGI scripts endpoint - comprehensive CGI testing
    location /cgi-bin {
        allow_methods GET HEAD POST
        cgi_path /home/ilyam/42/webserver/www/cgi-bin
        cgi_ext .py .js
        index index.html
    }

    # Static files with autoindex - images, CSS, JS
    location /imgs {
        allow_methods GET HEAD
        index nonexistent.html
        autoindex on
    }

    # Additional static files location for testing
    location /static {
        allow_methods GET HEAD
        index nonexistent.html
        autoindex on
    }

    # Favicon with multiple methods
    location /favicon.ico {
        allow_methods GET HEAD
        index index.html
    }

    # API endpoint - for JSON/XML responses with all methods
    location /api {
        allow_methods GET HEAD POST PUT PATCH DELETE OPTIONS
        index index.html
        autoindex off
    }

    # Admin area - restricted access
    location /admin {
        allow_methods GET HEAD
        index index.html
        autoindex off
    }

    # Test directory with autoindex
    location /testdir {
        allow_methods GET HEAD
        index nonexistent.html
        autoindex on
    }

    # Redirect test - old page to new page
    location /old-page {
        allow_methods GET HEAD
        index nonexistent.html
        return /upload.html
    }

    # Redirect test - temporary redirect
    location /temp-redirect {
        allow_methods GET HEAD
        index nonexistent.html
        return /api
    }

    # Error page configuration
    error_page 404 404.html

}

# -----------------------------------------------------------------------------
# COMPREHENSIVE TEST CASES FOR ALL HANDLERS AND CGI
#
# =============================================================================
# BASIC HTTP METHODS TESTING:
# =============================================================================
#
# GET requests:
# - curl http://localhost:8081/                    -> index.html (root)
# - curl http://localhost:8081/upload              -> upload.html (upload page)
# - curl http://localhost:8081/admin               -> index.html (admin area)
# - curl http://localhost:8081/favicon.ico         -> favicon (static file)
# - curl http://localhost:8081/api                 -> index.html (API endpoint)
# - curl http://localhost:8081/delete              -> delete.html (delete page)
#
# HEAD requests (same as GET but no body):
# - curl -I http://localhost:8081/                 -> headers only
# - curl -I http://localhost:8081/upload           -> headers only
# - curl -I http://localhost:8081/admin            -> headers only
#
# =============================================================================
# CGI FUNCTIONALITY TESTING:
# =============================================================================
#
# Python CGI scripts:
# - curl http://localhost:8081/cgi-bin/hello.py    -> execute Python script
# - curl -X POST -d "name=John" http://localhost:8081/cgi-bin/hello.py
#
# JavaScript CGI scripts:
# - curl http://localhost:8081/cgi-bin/hello.js    -> execute Node.js script
# - curl -X POST -d "data=test" http://localhost:8081/cgi-bin/hello.js
#
# CGI with query parameters:
# - curl "http://localhost:8081/cgi-bin/hello.py?param=value"
# - curl "http://localhost:8081/cgi-bin/hello.js?test=123"
#
# CGI error handling:
# - curl http://localhost:8081/cgi-bin/nonexistent.py -> 404 error
# - curl http://localhost:8081/cgi-bin/nonexistent.js -> 404 error
#
# =============================================================================
# UPLOAD AND DELETE FUNCTIONALITY:
# =============================================================================
#
# File upload (multipart/form-data):
# - curl -X POST -F "file=@test.txt" http://localhost:8081/uploads
#
# File listing (after upload):
# - curl http://localhost:8081/uploads           -> directory listing
#
# File deletion:
# - curl -X DELETE http://localhost:8081/uploads/test.txt
#
# =============================================================================
# AUTOINDEX AND STATIC FILES:
# =============================================================================
#
# Directory listings:
# - curl http://localhost:8081/imgs               -> image directory listing
# - curl http://localhost:8081/static             -> static files listing
# - curl http://localhost:8081/testdir            -> test directory listing
#
# Static file serving:
# - curl http://localhost:8081/imgs/imunaev-.png  -> serve image file
# - curl http://localhost:8081/favicon.ico        -> serve favicon
#
# =============================================================================
# REDIRECT TESTING:
# =============================================================================
#
# Redirect responses:
# - curl http://localhost:8081/old-page           -> redirect to /upload.html
# - curl http://localhost:8081/temp-redirect      -> redirect to /api
#
# =============================================================================
# ADVANCED HTTP METHODS:
# =============================================================================
#
# OPTIONS method (CORS preflight):
# - curl -X OPTIONS http://localhost:8081/api     -> allowed methods
#
# PUT/PATCH/DELETE methods:
# - curl -X PUT http://localhost:8081/api         -> method allowed
# - curl -X PATCH http://localhost:8081/api       -> method allowed
# - curl -X DELETE http://localhost:8081/api      -> method allowed
#
# =============================================================================
# ERROR HANDLING:
# =============================================================================
#
# 404 errors:
# - curl http://localhost:8081/nonexistent        -> 404 error page
# - curl http://localhost:8081/cgi-bin/bad.py     -> 404 error page
#
# Method not allowed:
# - curl -X POST http://localhost:8081/admin      -> 405 Method Not Allowed
# - curl -X DELETE http://localhost:8081/         -> 405 Method Not Allowed
#
# =============================================================================
# START THE SERVER:
# =============================================================================
#
# ./webserv configs/ilia_standart.conf
#
# Server will listen on: http://localhost:8081
#
# This configuration provides comprehensive testing of all web server handlers
# including CGI execution, file uploads, static file serving, redirects,
# and various HTTP methods with proper error handling.
# =============================================================================
