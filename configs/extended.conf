# =============================================================================
# WEBSERV EXTENDED CONFIGURATION FILE
# =============================================================================
#
# This configuration file defines multiple web server instances to test various
# scenarios including different permission levels, multiple sites, and server
# clustering. It demonstrates the webserv's ability to handle multiple servers
# simultaneously with different configurations.
#
# SERVER CONFIGURATIONS:
# 1. webserv (Port 8080) - Full functionality server with all features
# 2. ws2 (Port 8081) - Read-only server (no uploads, only GET/DELETE)
# 3. ws3 (Port 8082) - Upload-only server (no deletes, only GET/POST)
# 4. site2_server (Port 8083) - Simple static site
# 5. site3_server (Port 8084) - Simple static site
#
# TESTING SCENARIOS:
# - Multiple servers on different ports
# - Different permission levels per server
# - Server clustering and load distribution
# - Different root directories per server
# - Various client_max_body_size limits
#
# USAGE:
# ./webserv configs/extended.conf
# Then access:
# - http://127.0.0.1:8080 (full features)
# - http://127.0.0.1:8081 (read-only)
# - http://127.0.0.1:8082 (upload-only)
# - http://127.0.0.1:8083 (site2)
# - http://127.0.0.1:8084 (site3)
#
# =============================================================================

server {
	server_name webserv
	listen 8080
	host 127.0.0.1
	root www/webserv_project
	index index.html
	client_max_body_size 10000000
	error_page 404 errors/not_found_404.html
	error_page 413 errors/payload_too_large_413.html

	location /old {
		allow_methods GET
		return /redirect/redirection.html
		index index.html
	}

	location /redirect {
		allow_methods GET
		autoindex off
		index redirection.html
	}

	location / {
		allow_methods GET
		autoindex on
		index index.html
	}

	location /uploads {
		allow_methods GET DELETE POST
		upload_to uploads
		autoindex on
		index index.html
	}

	location /cgi-bin {
		allow_methods GET POST
		cgi_path cgi-bin
		cgi_ext .py .js
		index index.html
	}

	location .py {
		allow_methods GET POST
		cgi_path .
		cgi_ext .py
		index index.html
	}

	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	location /nested {
		allow_methods GET
		autoindex on
		index nested.html
	}

	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

server {
	server_name ws2
	listen 8081
	host 127.0.0.1
	root www/webserv_project
	index index.html
	client_max_body_size 10000000
	error_page 404 errors/not_found_404.html

	location / {
		allow_methods GET
		autoindex off
		index index.html
	}

	location /uploads {
		allow_methods GET DELETE
		upload_to uploads
		autoindex on
		index index.html
	}

	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	location /upload.html {
		allow_methods GET
		index upload.html
	}

	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

server {
	server_name ws3
	listen 8082
	host 127.0.0.1
	root www/webserv_project
	index index.html
	client_max_body_size 10000000

	location / {
		allow_methods GET
		autoindex off
		index index.html
	}

	location /uploads {
		allow_methods GET POST
		upload_to uploads
		autoindex on
		index index.html
	}

	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	location /delete.html {
		allow_methods GET
		index delete.html
	}

	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

server {
	server_name site2_server
	listen 8083
	host 127.0.0.1
	root www/site2
	index index.html
	client_max_body_size 10000

	location / {
		allow_methods GET
		autoindex off
		index index.html
	}

	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

server {
	server_name site3_server
	listen 8084
	host 127.0.0.1
	root www/site3
	index index.html
	client_max_body_size 10000

	location / {
		allow_methods GET
		autoindex off
		index index.html
	}

	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}
